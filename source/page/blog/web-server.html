<p><a href="{{ url }}blog.html">Billets</a> : Un serveur web à la maison</p>

<hr/>

<h2>Un serveur web à la maison</h2>

<p>
    <em>
        Si vous disposez de la fibre et d'une freebox, vous pouvez installer votre propre serveur web et héberger facilement toutes vos applications à la maison.
        Ce billet expose les différentes étapes pour l'installation et la configuration du serveur.
    </em>
</p>

<h3 id="p0">Sommaire</h3>

<ul>
    <li><a href="#p1">Introduction</a></li>
    <li><a href="#p2">Quels sont les risques ?</a></li>
    <li><a href="#p3">Free et la fibre</a></li>
    <li><a href="#p4">Quelle machine ?</a></li>
    <li><a href="#p5">Image d'installation</a></li>
    <li><a href="#p6">Préparer une Clé USB bootable</a></li>
    <li><a href="#p7">Installation du système d'exploitation</a></li>
    <li><a href="#p8">Configuration du système</a></li>
    <li><a href="#p9">Installation du serveur Web</a></li>
</ul>

<h3 id="p1">Introduction</h3>

<p>
    Pour héberger un site perso, un site statique, un blog, échanger des resources avec des proches, installer une application, gérer du code, se former, ou juste pour le fun, un serveur web maison est idéal.
    Pour une agence c'est aussi un excellent moyen de mettre en place gratuitement et rapidement des instances de recette, proposer des démos aux clients, du bug tracking...
</p>

<p>
    Mais il y a également une question de souplesse et de liberté, vous faites absolument ce que vous souhaitez de la machine. Pas d'engagement, pas de condition, pas de paiement.
    Personne ne vous facturera 10€ par mois pour l'utilisation d'une version obsolète de PHP (la spécialité chez Ionos).
    Nos applications sont là, à proximité, et il suffit de débrancher une prise pour les déconnecter.
    Si vous visitez <a href="https://magentix.space/">magentix.space</a> (serveur d'expérimentation),
    vous n'êtes pas dans un data center à Roubaix ou à Francfort, non, vous êtes dans mon entrée, sur un meuble en rottin.
</p>

<img src="{{ url }}media/blog/articles/freebox.png" alt="Freebox Delta" loading="lazy" />

<h3 id="p2">Quels sont les risques ?</h3>

<p>
     Au quotidien nous ne sommes jamais à l'abri d'une coupure de courant ou d'un problème réseau.
</p>

<p>
    Pour les coupures de courant un onduleur est assez efficace. Il garantit une continuité électrique et permet de se protégrer des micros coupures ou des chutes de tension.
    J'ai acheté il y a quelques années un <strong>Eaton Ellipse ECO 650</strong>, 650VA, batterie 12V, 7Ah, soit au minimum 6h d'autonomie pour une machine de 10 Watts (marge de 20%) :
</p>

<pre>
7Ah / ( 10w / 12v ) * 0.8 = 6.72h
</pre>

<p>

    Pour les longues coupures, liées par exemple aux intempéries, il faudra prendre votre mal en patience.
    Attention tout de même, si vous utilisez le CPL pour communiquer avec des équipements réseaux (comme le boîtier TV), il n'est pas possible de brancher la box sur l'onduleur. Le CPL ne fonctionnera plus.
</p>

<p class="warning">
    <strong>Note :</strong> Une <strong>freebox delta</strong> (équipée d'un seul disque dur 2,5") consomme <strong>27,2 Watts</strong>. Avec le <strong>Eaton Ellipse ECO 650</strong> elle continuera de fonctionner environ <strong>2.5h</strong> si elle est branchée seule.
    Si la panne de courant concerne également le NRO il n'y aura plus la fibre non plus, mais les NRO sont également équipés d'un onduleur...
</p>

<p>
    Pour les problèmes réseaux entre le terminal optique du logement et les équipements de l'opérateur, cela reste assez rare.
    En 3 ans cela m'est arrivé à 2 reprises : un mauvais branchement du technicien lors d'une intervention sur la baie.
    Dans ce cas la déconnexion peut durer plusieurs jours, le temps que le technicien se déplace pour constater la panne et réparer.
    Les pannes générales sur les répartiteurs sont souvent traitées rapidement. Les opérateurs ne laissent jamais plusieurs centaines d'abonnées sans connexion.
</p>

<p>
    <strong>De manière générale c'est à vous de juger l'intérêt d'une installation selon les pannes rencontrées dans votre région et l'utilisation que vous souhaitez faire du serveur.</strong> Si vous déménagez 2 fois par an cela risque d'être également un peu contraignant.
</p>

<p>
    Je pense qu'il faut éviter d'héberger à la maison un site ou une application pour lesquels une déconnexion peut avoir un impact important pour les utilisateurs, la visibilité et l'activité.
</p>

<h3 id="p3">Free et la fibre</h3>

<p>
    Free est l'un des seules opérateurs en France à proposer depuis toujours l'attribution d'une IP v4 fixe (sur demande). Gratuitement.
    Pour monter un serveur c'est important. Dans le cadre d'une installation domotique pilotée à distance également.
    Chez Orange cela est réservé aux professionnels, chez les autres je ne sais pas mais il me semble que c'est impossible.
    Il faut dans ce cas se tourner vers des solutions DynDNS, mais je n'ai jamais expérimenté.
</p>

<p>
    Par défaut votre IP v4 chez Free est partagé avec 4 clients. L'opérateur réserve simplement une plage de ports différente. Cela permet de pallier (sans doute provisoirement) à la pénurie d'IP v4 que nous rencontrons actuellement.
    Pour 100000 clients, Free n'a plus besoin de 100000 IPs v4, mais de 25000. Cela convient parfaitement pour un usage traditionnel. Mais pour notre serveur, il faut demander une adresse IP fixe personnelle.
</p>

<p>
    Il est fort probable que nous soyons obligé un jour de basculer complétement vers de l'IP v6. Il est déjà possible de le faire si vos machines le supportent.
</p>

<p>
    Pour le moment nous resterons sur de l'IP v4. Il faut vérifier dans un premier temps que l'attribution d'une adresse IP fixe est possible depuis le compte client : <strong>Ma Freebox > Demander une adresse IP fixe V4 full-stack</strong>.
</p>

<img src="{{ url }}media/blog/articles/freebox-ipv4-fullstack.png" alt="Free Adresse IP fixe V4 full-stack" loading="lazy" />

<p>
    Si vous n'avez pas l'option il sera un peu plus compliqué d'accéder à distance à vos applications.
</p>

<p>
    Je recommande donc fortement une connexion fibrée chez Free...
</p>

<p>
    Niveau temps de réponse, c'est très bon, même excellent. Mieux que chez beaucoup d'hébergeurs.
</p>

<img src="{{ url }}media/blog/articles/freebox-fibre-vs-netlify.png" alt="TTBF Freebox vs Netlify" loading="lazy" />

<aside>Freebox FTTH vs Netlify</aside>

<p>
    Ce graphique met en évidence le temps de latence pour des requêtes vers une <strong>Freebox FTTH</strong> (à gauche), puis <strong>Netlify</strong> (à droite).
    Les sondes sont situées à Roubaix et Londres. Chez Netlify c'est beaucoup plus cahotique.
</p>

<h3 id="p4">Quelle machine ?</h3>

<p>
    C'est un vaste sujet... Cela dépend de ce que l'on souhaite hérberger sur le serveur.
    Dans le passé j'ai toujours eu tendance à prendre des machines surdimensionnées par rapport à l'usage que j'en avais.
    <em>"On ne sait jamais, ça peut servir"</em>. C'est une erreur. De l'argent dépensé inutilement.
</p>

<p>
    Il y a 4 critères à prendre en compte :
</p>

<ul>
    <li>Les applications web que l'on souhaite utiliser (Wordpress, Magento, site statique...)</li>
    <li>Le traffic estimé</li>
    <li>La consomation électrique nécessaire au fonctionnement de la machine</li>
    <li>La place dont vous disposez à proximité de la box</li>
</ul>

<p>
    La bonne nouvelle est que de manière générale une machine peu puissante suffit. Un simple Raspberry Pi avec Nginx sert parfaitement un site statique.
</p>

<p>
    Il faut simplement adapter en fonction des recommandations communiquées par les éditeurs. Anticiper si possible le nombre de connexion simultanées.
</p>

<p>
    Si c'est une machine recyclée qui n'avait plus d'utilité c'est encore mieux.
</p>

<p>
    Ici j'ai souhaité une machine peu encombrante, presque invisible.
    Cette machine doit remplacer le serveur que j'utilise depuis 3 ans et pour lequel j'ai d'autres projets.
    La box est située dans l'entrée de la maison, je n'ai pas envi d'y mettre une tour.
    J'attache également beaucoup d'importance à la consomation électrique, la machine est allumée non stop.
    Pour finir je ne souhaite héberger que des sites statiques (jekylls, Hugo...), avec un traffic très faible.
</p>

<p>
    Je suis un lecteur du site <a href="https://www.minimachines.net">minimachines.net</a>.
    Au moment de mes recherches Pierre Lecourt publiait une offre pour un nouveau mini PC fanless, le Mele Quieter2.
    C'est ce genre de machine qu'il me fallait. Cerise sur le gâteau, le PC est insensible à la poussière.
</p>

<p>
    Mais sur un PC d'une marque chinoise peu connue on ne sait jamais très bien comment une distribution Linux va tourner.
    C'est un risque modéré car il n'y a généralement rien d'extravagant. Il faut surtout s'inquiéter de la finission générale de l'engin.
    Il m'est arrivé de me retrouver avec des machines au bruit insuportable ou avec des connecteurs défectueux.
    Toujours attendre un peu, n'acheter que s'il y a plusieurs retours positifs.
</p>

<p>
    Pour cet article, l'installation a donc été effectuée sur le Mele Quieter2.
    Il a également l'avantage de consommer <strong>moins de 1.5w</strong> quand il ne se passe rien (sans disque supplémentaire).
    Cela représente quelques centimes par mois.
</p>

<p>
    Comparatif de la consommation de 3 mini machines (aucune activité) :
</p>

<img src="{{ url }}media/blog/articles/consommation-electrique.png" alt="Consommation électrique" loading="lazy" />

<table>
    <tr>
        <th>Machine</th>
        <th>OS</th>
        <th>Conso.</th>
    </tr>
    <tr>
        <td>Raspberry Pi 4<br /><em>Standard</em></td>
        <td>Raspberry Pi OS</td>
        <td><strong>2.5w</strong></td>
    </tr>
    <tr>
        <td>ASUS PN60<br /><em>SSD 256Go - 32Go ram</em></td>
        <td>Debian</td>
        <td><strong>8.5w</strong></td>
    </tr>
        <tr>
        <td>Mele Quieter2<br /><em>Standard</em></td>
        <td>Debian</td>
        <td><strong>1.2w</strong></td>
    </tr>
</table>

<p>
    Le <strong>Mele Quieter2</strong> est monté au maximum à <strong>5.1w</strong> avec <strong>283 requêtes HTTP par seconde</strong> sur un site statique.
</p>

<p>
    Héberger un site sur un Mele Quieter2 coûte moins de 2€ par an.
</p>

<p class="warning">
    <strong>Note :</strong> ce sont ici des mini-machines avec des composants à très faible consommation.
    Si vous utilisez une vielle tour qui traîne dans un coin on pourrait facilement se situer aux alentours des 100w.
    Il existe de nombreux sites pour estimer la consommation d'un PC, par exemple <a href="https://outervision.com/power-supply-calculator">Power Supply Calculator</a>.
</p>

<h3 id="p5">Image d'installation</h3>

<p>
    Pour le système d'exploitation c'est au choix, généralement pour du serveur on trouve :
</p>

<ul>
    <li>Debian</li>
    <li>CentOS</li>
    <li>Ubuntu server</li>
    <li>FreeBSD</li>
</ul>

<p>
    Il en existe beaucoup d'autres. J'en ai essayé pas mal mais j'ai une nette préférence pour Debian. J'y reviens toujours. C'est très personnel.
</p>

<p>
    <strong>J'effectue dans cet article une installation Debian</strong>, mais vous pouvez adapter sans problème selon votre OS préféré.
</p>

<p>
    Je réalise l'installation de l'OS à partir d'une clé USB bootable.
    On peut utiliser n'importe quelle clé, avec une capacité suffisante pour accueillir l'image d'installation.
    J'ai une petite clé <strong>SanDisk de 16Go</strong>, ça coûte moins de 10€.
</p>

<p>
    Les systèmes fournissent des images de type <strong>img</strong> ou <strong>iso</strong>. Pour Debian on la télécharge via le lien suivant :
</p>

<p>
    <a href="https://www.debian.org/CD/http-ftp/#stable">Télécharger les images de CD de Debian par HTTP ou par FTP</a>
</p>

<p>
    Le téléchargement d'une image requiert de connaître le type de processeur. Dans la majorité des cas votre CPU est de type amd64.
    Pour faire simple, si la machine a moins 20 ans et peut faire tourner Windows c'est de l'amd64.
    Les choses vont peut être changer dans le futur avec l'arrivée d'Apple M1 et du Lakefield chez Intel (ARM).
    Pour un Raspberry Pi 4 c'est de l'arm64, mais Raspberry Pi OS est basé sur Debian, il est préférable d'utiliser cet OS.
</p>

<p>
    Si vous avez la possibilité de relier le PC à la box en ethernet pendant l'installation, partez sur l'image <strong>debian-X.X.X-amd64-netinst.iso</strong>, sinon <strong>debian-X.X.X-amd64-xfce-CD-1.iso</strong>.
    Il est fréquent que la configuration du wifi requiert des drivers spécifiques, toujours un peu galère pendant la phase d'installation.
</p>

<p>
    De mon côté j'ai la chance d'avoir un D-Link DAP-1360 (environ 30€) configuré en mode Wireless (le bureau est loin de la box), j'y branche simplement la machine en ethernet.
</p>

<img src="{{ url }}media/blog/articles/dlink-dap-1360.png" alt="Dlink DAP 1360" loading="lazy" />

<p>
    Mais vous pouvez sans problème effectuer l'installation sans Internet à partir de l'image CD complète (<strong>debian-X.X.X-amd64-xfce-CD-1.iso</strong>).
</p>

<h3 id="p6">Préparer une Clé USB bootable</h3>

<p>
    Pour créer une clé USB bootable à partir de l'image téléchargée, 2 solutions.
</p>

<h4>Depuis Windows</h4>

<section>
    <p>
        Si vous êtes sous Windows, le logiciel <a href="https://rufus.ie/fr/">Rufus</a> est parfait.
    </p>

    <img src="{{ url }}media/blog/articles/rufus.png" alt="Logiciel Rufus" loading="lazy" />

    <p>
        Il y a quelques options à paramétrer :
    </p>

    <ul>
        <li><strong>Périphérique :</strong> la clé USB</li>
        <li><strong>Type de démarrage :</strong> l'image d'installation précédemment téléchargée</li>
        <li><strong>Schéma de partition :</strong> GPT *</li>
        <li><strong>Système de destination :</strong> UEFI</li>
        <li><strong>Système de fichiers :</strong> FAT32</li>
        <li><strong>Taille d’unité d’allocation :</strong> Défaut</li>
    </ul>

    <p>
        * Je pars du principe que le futur serveur est une machine assez récente (après 2012) avec <strong>firmeware UEFI</strong> et disque avec <strong>partition GPT</strong>.
        Si vous doutez, il faut visualiser le <strong>setup</strong> de la carte mère.
        Au démarrage (splash screen) actionnez la touche d'accès au setup (<kbd>Esc</kbd>, <kbd>Suppr</kbd>, <kbd>F2</kbd>, <kbd>F10</kbd>...), généralement la touche est indiquée.
        Si vous êtes sur de l'UEFI cela est obligatoirement mentionné quelque part.
    </p>

    <img src="{{ url }}media/blog/articles/bios-uefi.png" alt="Bios Legacy ou UEFI" loading="lazy" />

    <aside>UEFI du Asus PN60 (sur de nombreuses cartes mères Asus) et du Mele Quieter2 (Aptio setup utility, un classique)</aside>

    <p>
        Il peut arriver que le boot soit en mode BIOS Legacy.
        Revenez sur de l'UEFI si cela est le cas (même si le disque est en MBR il sera formaté intégralement).
    </p>

    <p>
        Après validation, il est possible que Rufus vous demande le mode d'écriture de l'image. Restez sur l'option recommandée (Ecrire en mode image ISO).
    </p>

    <img src="{{ url }}media/blog/articles/rufus-isohybrid.png" alt="Rufus mode d'écriture de l'image" loading="lazy" />
</section>

<h4>Depuis un système UNIX</h4>

<section>
    <p>
        Si vous êtes sous un système UNIX (Ubuntu, Debian, MacOS...), on peut passer par la commande <code>dd</code>.
    </p>

    <p>
        Il faut dans un premier temps identifier le fichier périphérique sur lequel la clé est accessible.
        J'utilise la commande <code>dmesg</code> juste après avoir branché la clé USB.
    </p>

<pre>
sudo <strong>dmesg</strong>
</pre>

<pre>
[1129003.393918] usb-storage 2-4.3:1.0: USB Mass Storage device detected
[1129003.394285] scsi host1: usb-storage 2-4.3:1.0
[1129004.398960] scsi 1:0:0:0: Direct-Access     SanDisk  Ultra            1.00 PQ: 0 ANSI: 6
[1129004.399389] sd 1:0:0:0: Attached scsi generic sg0 type 0
[1129004.399661] sd 1:0:0:0: [<span class="ll-num">sda</span>] 30464000 512-byte logical blocks: (15.6 GB/14.5 GiB)
[1129004.400584] sd 1:0:0:0: [<span class="ll-num">sda</span>] Write Protect is off
[1129004.400588] sd 1:0:0:0: [<span class="ll-num">sda</span>] Mode Sense: 43 00 00 00
[1129004.400897] sd 1:0:0:0: [<span class="ll-num">sda</span>] Write cache: disabled, read cache: enabled, doesn't support DPO or FUA
[1129004.422517] <span class="ll-num">sda</span>: sda1
[1129004.423849] sd 1:0:0:0: [<span class="ll-num">sda</span>] Attached SCSI removable disk
</pre>

    <p>
        On identifie ici clairement que nous sommes sur <code>/dev/sda</code> (ce peut être <strong>sdb</strong>, <strong>sdc</strong>... ou autre), avec une partition (sda1). Ce que l'on peut vérifier avec la commande <code>df</code>.
    </p>

<pre>
sudo <strong>df</strong>
</pre>

<pre>
<span class="ll-num">/dev/sda1</span>    15G    8,0K   15G   1% /media/xxxxxxx/name
</pre>

    <p>
        Ou encore la commande <code>lsblk</code>.
    </p>

<pre>
sudo <strong>lsblk</strong>
</pre>

<pre>
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
<span class="ll-num">sda</span>           8:0    0  14,5G   0 disk
└─ <span class="ll-num">sda1</span>       8:1    0  14,5G   0 part /media/xxxxxxx/name
</pre>

    <p>
        <strong>Note :</strong> si c'est une clé toute neuve ou complétement formatée il n'y a pas forcement de partition (sdaX).
    </p>

    <p class="alert">
        <strong>Pour la suite n'oubliez pas de remplacer le fichier périphérique par celui identifié sur votre système (sda, sdb, sdc...)
        au risque de perdre toutes les informations contenues sur un disque.</strong>
    </p>

    <p>
        Il nous reste, à l'aide de la commande <code>dd</code>, à copier l'image sur la clé USB. <strong>Ne pas oublier de démonter la clé au préalable.</strong>
    </p>

<pre>
sudo <strong>umount</strong> <span class="ll-num">/dev/sda1</span>
</pre>

    <aside>Si la partition est montée sur sda1</aside>

<pre>
sudo <strong>umount</strong> <span class="ll-num">/dev/sda</span>
</pre>

    <aside>Si la clé USB est montée sur sda</aside>

<pre>
sudo <strong>dd</strong> if=<strong>debian-X.X.X-amd64-netinst.iso</strong> of=<span class="ll-num">/dev/sda</span> bs=1M
</pre>

    <aside>Avec l'image <strong>Debian network install</strong> si la machine dispose d'une connexion Internet</aside>

<pre>
sudo <strong>dd</strong> if=<strong>debian-X.X.X-amd64-xfce-CD-1.iso</strong> of=<span class="ll-num">/dev/sda</span> bs=1M
</pre>

    <aside>Avec l'image <strong>Debian CD</strong> si la machine ne peut être connectée à Internet</aside>

    <p>
        Si tout va bien on obtient après quelques secondes :
    </p>

<pre>
337+0 enregistrements lus
337+0 enregistrements écrits
353370112 bytes (353 MB, 337 MiB) copied, 29,0891 s, 12,1 MB/s
</pre>

</section>

<p>
    <strong>La clé USB est prête</strong>, on la branche sur le futur serveur.
</p>

<h3 id="p7">Installation du système d'exploitation</h3>

<p>
    Au démarrage du système, au splash screen, on active rapidement la touche pour l'accès au setup. La touche diffère selon les constructeurs : <kbd>Esc</kbd>, <kbd>Suppr</kbd>, <kbd>F2</kbd>, <kbd>F10</kbd>...
    En général la touche est indiquée. Pour le <strong>Mele Quieter2</strong> c'est <kbd>Suppr</kbd>.
</p>

<p>
    Une fois sur le <strong>BIOS/UEFI</strong>, on se dirige vers la section <code>boot</code>, ou parfois <code>démarrage</code> en Français.
</p>

<img src="{{ url }}media/blog/articles/uefi-aptio-boot.png" alt="UEFI Aptio Boot" loading="lazy" />

<p>
    L'obectif et d'amorcer le démarrage sur la <strong>clé USB</strong> et non sur les autres disques, en lui accordant la priorité. On enregistre et on redémarre.
</p>

<p>
    Le système démarre sur la clé USB et si tout a bien fonctionné, l'écran d'installation du système d'exploitation est affiché.
</p>

<img src="{{ url }}media/blog/articles/debian-install-screen.png" alt="Installation du système d'exploitation Debian" loading="lazy" />

<p>
    J'effectue l'installation de <strong>Debian</strong>, si vous optez pour un autre système c'est généralement assez similaire.
</p>

<p>
    Par habitude je préfère l'installation classique (Install), je n'utilise jamais l'installation graphique. Mais les étapes sont exactement les mêmes.
</p>

<section>
    <ul>
        <li><strong>Language :</strong> French - Français</li>
        <li><strong>Pays :</strong> France</li>
        <li><strong>Disposition du clavier :</strong> Français</li>
        <li><strong>Wifi (optionnel) :</strong> si le réseau n'est pas accessible, Debian tente une connexion wifi qui échoue la plus part du temps en raison des drivers manquants. Passez cette étape puis sélectionnez "Ne pas configurer le réseau maintenant"</li>
        <li><strong>Nom de la machine :</strong> indiquez ce que vous souhaitez, de préférence un nom qui n'existe pas déjà sur le réseau, ce sera plus simple de l'identifier par la suite</li>
        <li><strong>Mot de passe root :</strong> mot de passe souhaité</li>
        <li><strong>Nom complet du nouvel utilisateur :</strong> votre identifiant</li>
        <li><strong>Forcer l'installation UEFI (optionnel) :</strong> Debian peut détecter un système installé en mode de compatibilité BIOS. On force alors l'UEFI.</li>
        <li><strong>Partitionner les disques :</strong> sauf pour des cas très particuliers, vous pouvez choisir "Utiliser un disque entier", puis "tous dans une seule partition (recommandé pour les débutants)". On applique enfin les changements sur les disques.</li>
    </ul>
    <p>
        L'installation du système de base commence. Il reste à configurer l'outil de gestion des paquets (sans miroir sur le réseau si vous êtes offline), et enfin la <strong>sélection des logiciels</strong>.
    </p>

    <p>
        A cette étape <strong>ne sélectionnez que 2 options</strong> :
    </p>

<pre>
[ ] environnement de bureau Debian
[ ] serveur web
[ ] serveur d'impression
[*] serveur SSH
[*] utilitaires usuels du système
</pre>

    <ul>
        <li><strong>Serveur SSH</strong> car la connexion au serveur se fera à distance. Une fois l'installation et la configuration terminées on branche la machine sur la box et elle n'en bougera plus.</li>
        <li><strong>Utilitaires usuels du système</strong> comprend une série d'applications pour gérer le système d'exploitation.</li>
    </ul>

    <p>
        Je ne sélectionne jamais <strong>serveur web</strong> à cette étape, je préfère une installation manuelle.
    </p>
</section>

<p>
    Le système est installé, on redémarre.
</p>

<h3 id="p8">Configuration du système</h3>

<h4>Editeur de texte</h4>

<p>
    Pour éditer les fichiers de configuration, utilisez un éditeur que vous appréciez. Par défaut nous n'avons que <code>vi</code>.
    Cela convient aux puristes mais <code>nano</code> facilite grandement la tâche.
</p>

<p>
    Si vous êtes en mode offline, utilisez <code>vi</code> à l'étape suivante (Adresse IP), vous pourrez installer autre chose par la suite.
</p>

<pre>
<strong>apt-get</strong> update
<strong>apt-get</strong> install nano
</pre>

<h4>Adresse IP</h4>

<p>
    Nous devons attribuer à la machine une adresse IP fixe en dehors de la plage d'adresses IP réservées par la box pour le DHCP.
</p>

<p>
    Contrôlez cette plage d'adresses dans la configuration de la freebox en vous connectant depuis le navigateur sur <a href="http://mafreebox.freebox.fr" rel="nofollow">http://mafreebox.freebox.fr</a>.
</p>

<p>
    Dans le menu <strong>Paramètres de la freebox > Réseau local > DHCP</strong>, on visualise le début et la fin de la plage d'adresses :
</p>

<img src="{{ url }}media/blog/articles/freebox-dhcp.png" alt="Freebox configuration du DHCP" loading="lazy" />

<p>
    Le DHCP est configuré ici pour attribuer des adresses entre <strong>192.168.1.2</strong> et <strong>192.168.1.50</strong>.
</p>

<p class="warning">
    Il est également possible dans la configuration de la freebox d'attribuer un bail DHCP statique selon l'adresse mac de la machine, mais par expérience évitez d'utiliser ce système.
</p>

<p>
    Sur le serveur, connectez vous au compte <strong>root</strong> via la commande <code>su</code>, puis éditez le fichier <code>/etc/network/interfaces</code>.
</p>

<pre>
<strong>su</strong>
<strong>nano</strong> /etc/network/interfaces
</pre>

<p>
    Nous avons <strong>dhcp</strong> pour l'interface réseau. Par exemple :
</p>

<pre>
iface <span class="ll-nam">enp2s0</span> inet <span class="ll-str">dhcp</span>
</pre>

<aside>L'interface est ici enp2s0, diffère selon les systèmes</aside>

<p>
    On remplace avec une IP fixe en dehors de la plage d'adresses DHCP de la box. J'ai choisi <strong>192.168.1.60</strong>.
</p>

<pre>
<span class="ll-com"># This file describes the network interfaces available on your system</span>
<span class="ll-com"># and how to activate them. For more information, see interfaces(5).</span>

source /etc/network/interfaces.d/*

<span class="ll-com"># The loopback network interface</span>
auto <span class="ll-nam">lo</span>
iface <span class="ll-nam">lo</span> inet <span class="ll-str">loopback</span>

<span class="ll-com"># The primary network interface</span>
auto <span class="ll-nam">enp2s0</span>
allow-hotplug <span class="ll-nam">enp2s0</span>
iface <span class="ll-nam">enp2s0</span> inet <span class="ll-str">static</span>
    address <span class="ll-num">192.168.1.60</span>
    netmask <span class="ll-num">255.255.255.0</span>
    gateway <span class="ll-num">192.168.1.254</span>
    broadcast <span class="ll-num">192.168.1.255</span>
</pre>

<aside>/etc/network/interfaces</aside>

<p>
    On peut redémarrer :
</p>

<pre>
/etc/init.d/networking <strong>restart</strong>
</pre>

<p>
    On vérifie que l'adresse IP a bien été attribuée avec la commande <code>ip a</code> :
</p>

<pre>
ip a
</pre>

<p>
    <strong>Nous pouvons maintenant relier définitivement la machine à la box (sans écran ni clavier) et utiliser n'importe quel PC pour s'y connecter à distance.</strong>
</p>

<p>
    Petite vérification au préalable :
</p>

<pre>
systemctl status ssh
</pre>

<p>
    Nous avions installer le serveur SSH lors du choix des logiciels à l'installation de Debian. Si vous avez omis cette étape il faut l'installer maintenant : <code>apt-get install openssh-server</code>.
</p>

<p>
    Par défaut le serveur SSH n'accepte pas de connexion directe au compte <strong>root</strong>. C'est une configuration que l'on peut modifier en éditant le fichier <code>/etc/ssh/sshd_config</code> (<strong>PermitRootLogin</strong>).
    Mais si vous souhaitez autoriser les connexions SSH depuis l'extérieur je le déconseille fortement. Pensez également dans ce cas à modifier le port de connexion par défaut (22).
</p>

<p>
    Une fois la machine connectée en ethernet à la box, utilisez d'importe quelle machine avec un client ssh pour vous y connecter. Depuis windows 10 vous pouvez utiliser directement la commande <code>ssh</code> dans le <strong>command prompt</strong>.
    Pour les versions antérieures vous pouvez passer par <a href="https://www.putty.org/" rel="nofollow">putty</a>. Pour les systèmes UNIX c'est la commande <code>ssh</code>.
</p>

<pre>
<strong>ssh</strong> <span class="ll-nam">username</span>@<span class="ll-num">192.168.1.60</span>
</pre>

<h3 id="p9">Installation du serveur Web</h3>

<div class="toolbar">
    <a href="#p0">Sommaire</a>
</div>