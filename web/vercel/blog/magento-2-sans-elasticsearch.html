<!DOCTYPE html>
<!--
  __    __     ______     ______     ______     __   __     ______    __     __  __
 /\ "-./  \   /\  __ \   /\  ___\   /\  ___\   /\ "-.\ \   /\__  _\  /\ \   /\_\_\_\
 \ \ \-./\ \  \ \  __ \  \ \ \__ \  \ \  __\   \ \ \-.  \  \/_/\ \/  \ \ \  \/_/\_\/_
  \ \_\ \ \_\  \ \_\ \_\  \ \_____\  \ \_____\  \ \_\\"\_\    \ \_\   \ \_\   /\_\/\_\
   \/_/  \/_/   \/_/\/_/   \/_____/   \/_____/   \/_/ \/_/     \/_/    \/_/   \/_/\/_/
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Utiliser Magento 2 sans Elasticsearch</title>
        <meta name="description" content="Depuis la version 2.4 de Magento, Elasticsearch est imposé nativement. Il est cependant possible de le désactiver." />
        <link rel="stylesheet" href="https://vercel.magentix.fr/css/style.css" />
        <meta name="robots" content="NOINDEX,NOFOLLOW" />
    </head>
    <body>
        <header>
            <div id="header-content">
                <h1><a href="https://vercel.magentix.fr/"><img src="https://vercel.magentix.fr/media/magentix.png" alt="magentix" width="232" height="60" /></a></h1>
                <p>Développeur Magento indépendant depuis 2009</p>
                <nav>
                    <a href="https://vercel.magentix.fr/">Accueil</a> &bull;
                    <a href="https://vercel.magentix.fr/blog.html">Billets</a>
                </nav>
            </div>
        </header>
        <main>
            <div id="main-content">
<!-- Content -->
<p><a href="https://vercel.magentix.fr/blog.html">Billets</a> : Magento 2 sans Elasticsearch</p>

<hr/>

<h2>Magento 2 sans Elasticsearch</h2>

<p>
    <em>
        Depuis la version 2.4, Elasticsearch est imposé nativement. L'installation de Magento n'aboutira pas si Elasticsearch n'est pas disponible.
        Mais il est tout à fait possible de s'en passer...
    </em>
</p>

<p>
    Pour certains sites e-commerce le moteur de recherche n'est pas une priorité. Par exemple si le site ne dispose que de quelques produits, voir même s'il est mono-produit.
    En imposant Elasticsearch il est également plus complexe d'installer Magento, ce n'est pas forcement adapté pour les commerçants avec un faible budget alloué à l'hébergement.
    Car Magento 2 peut parfaitement fonctionner sur un serveur à faible coût, à condition évidemment de rester sur des fonctionnalités classiques et de disposer d'un catalogue assez peu volumineux.
</p>

<p>
    Se séparer d'Elasticsearch est donc adapté dans des cas très particuliers (sinon il serait dommage de s'en priver).
</p>

<p>
    Pour supprimer Elasticsearch de Magento, ajoutez au noeud <strong>replace</strong> du fichier <strong>composer.json</strong> les lignes suivantes :
</p>

<pre>
{
    "replace": {
        "magento/module-elasticsearch": "*",
        "magento/module-elasticsearch-6": "*",
        "magento/module-elasticsearch-7": "*",
        "magento/module-inventory-elasticsearch": "*"
    }
}
</pre>

<p>
    Exécutez ensuite un <code>composer install</code>.
</p>

<p>
    Pour les sites <strong>Adobe Commerce</strong>, ajoutez également <code>magento/module-elasticsearch-catalog-permissions</code>.
</p>

<p>
    A ce stade vous pouvez faire tourner Magento sans disposer d'Elasticsearch. Le champ recherche apparaît mais une requête provoque une erreur.
</p>

<h3>1. Vous souhaitez conserver un moteur de recherche</h3>

<p>
    Il est possible de revenir au moteur de type MySQL développé par Magento dans les versions antérieures.
</p>

<p>
    Le module MySQL Search (Legacy) est mis à disposition par <strong>swissup</strong> : <a href="https://github.com/swissup/module-search-mysql-legacy">Legacy Mysql Search</a>.
</p>

<p>
    <strong>Swissup</strong> propose 2 manières d'installer le module, la première requiert l'installation de leur marketplace. Privilégiez une installation manuelle en
    décompressant l'archive de la <a href="https://github.com/swissup/module-search-mysql-legacy/releases">dernière release</a> dans le dossier <code>app/code/Swissup/SearchMysqlLegacy</code>.
</p>

<p>
    Une fois en place exécutez un <code>php bin/magento setup:upgrade</code>.
</p>

<p>
    Il ne reste plus qu'à indiquer à Magento le moteur à utiliser. La configuration se situe dans le menu <strong>Stores > Configuration > Catalog > Catalog > Catalog Search</strong>.
</p>

<p>
    Pour l'option <strong>Search Engine</strong>, sélectionnez <strong>Legacy MySQL (deprecated)</strong>.
</p>

<img src="https://vercel.magentix.fr/media/blog/articles/legacy-mysql-magento.png" alt="Legacy MySQL Magento" />

<h3>2. Vous souhaitez supprimer le moteur de recherche</h3>

<p>
    Si vous n'avez pas besoin d'un moteur de recherche, plusieurs modules sont à désactiver. La fonctionnalité <strong>staging</strong> ne sera plus disponible.
</p>

<pre>
{
    "replace": {
        "magento/module-elasticsearch": "*",
        "magento/module-elasticsearch-6": "*",
        "magento/module-elasticsearch-7": "*",
        "magento/module-inventory-elasticsearch": "*",
        "magento/module-advanced-search": "*",
        "magento/module-catalog-search": "*",
        "magento/module-search": "*",
        "magento/module-inventory-catalog-search": "*",
        "magento/module-search-staging": "*",
        "magento/module-bundle-import-export-staging": "*",
        "magento/module-bundle-staging": "*",
        "magento/module-catalog-import-export-staging": "*",
        "magento/module-catalog-inventory-staging": "*",
        "magento/module-catalog-page-builder-analytics-staging": "*",
        "magento/module-catalog-rule-staging": "*",
        "magento/module-catalog-staging": "*",
        "magento/module-catalog-staging-page-builder": "*",
        "magento/module-catalog-url-rewrite-staging": "*",
        "magento/module-checkout-staging": "*",
        "magento/module-cms-page-builder-analytics-staging": "*",
        "magento/module-cms-staging": "*",
        "magento/module-configurable-product-staging": "*",
        "magento/module-downloadable-staging": "*",
        "magento/module-gift-card-staging": "*",
        "magento/module-gift-message-staging": "*",
        "magento/module-gift-wrapping-staging": "*",
        "magento/module-google-optimizer-staging": "*",
        "magento/module-grouped-product-staging": "*",
        "magento/module-layered-navigation-staging": "*",
        "magento/module-msrp-staging": "*",
        "magento/module-payment-staging": "*",
        "magento/module-product-video-staging": "*",
        "magento/module-review-staging": "*",
        "magento/module-reward-staging": "*",
        "magento/module-rma-staging": "*",
        "magento/module-sales-rule-staging": "*",
        "magento/module-search-staging": "*",
        "magento/module-staging": "*",
        "magento/module-staging-page-builder": "*",
        "magento/module-weee-staging": "*"
    }
}
</pre>

<p>
    Pour les sites <strong>Adobe Commerce</strong>, prévoyez également de vous séparer de <code>magento/module-quick-order</code> (B2B) et de <code>magento/module-elasticsearch-catalog-permissions</code>.
</p>

<p>
    Cette fois le champ de recherche natif n'apparaît plus.
</p>
<!-- /Content -->
            </div>
        </main>
        <footer>
            <div id="footer-content">
                <p><strong>Magentix</strong> © 2009 / 2021</p>
                <p><small>Réalisé avec <a href="https://www.stapy.net">StaPy</a></small></p>
                <nav><a href="https://vercel.magentix.fr/mentions.html">Mentions légales</a> &bull; <a href="/blog.html">Billets</a></nav>
            </div>
        </footer>
        <script type="text/javascript" src="https://vercel.magentix.fr/js/highlight.min.js"></script>
        <script type="text/javascript" src="https://vercel.magentix.fr/js/app.js"></script>
    </body>
</html>